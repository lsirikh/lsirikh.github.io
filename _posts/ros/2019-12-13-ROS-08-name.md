---
layout: single
title:  "08.ROS 네임(Name)"
permalink: /categories/:categories/:title:output_ext
taxonomy: {title}
categories: ROS
tags: ROS 네임 name
comments: true
toc: true
toc_label: "My Table of Contents"
toc_icon: "cog"
---


## 1. 개념

ROS에는 기본 개념으로 **그래프**라는 추상 데이터 유형이 있다. 이 그래프는 각 노드 간의 연결 관계와 화살표로 보내고받는 메시지 (데이터)의 관계를 보여준다. 이를 위해 ROS의 노드, 토픽 및 서비스에 사용되는 메시지 및 매개 변수는 모두 고유 한 이름을 갖습니다.

## 2. 종류

* 글로벌(global)
* 프라이빗(private)


{% highlight c linenos %}
int main(int argc, char **argv) 		
// Node Main Function
{
ros::init(argc, argv, "node1"); 		 // Node Name Initialization
ros::NodeHandle nh; 			 // Node Handle Declaration
// Publisher Declaration, Topic Name = bar
ros::Publisher node1_pub = nh.advertise<std_msg::Int32>("bar", 10);
{% endhighlight %}

위 예에서 노드 이름은 `/node1`이다. 퍼블리셔가 기호없이 `bar`로 선언 된 경우 주제의 상대 이름은 `/bar`이다. 슬래시 (`/`) 문자를 사용하여 전역으로 선언하더라도 토픽 이름은 여전히 `/bar`이다.

* 글로벌

{% highlight c linenos %}
ros::Publisher node1_pub = nh.advertise<std_msg::Int32>("/bar", 10);
{% endhighlight %}

그러나 프라이빗(`~`)으로 선언한 경우 토픽 네임이 `/node1/var`가 된다.

* 프라이빗

{% highlight c linenos %}
ros::Publisher node1_pub = nh.advertise<std_msg::Int32>("~bar", 10);
{% endhighlight %}

`/wg`는 네임 스페이스가 변경된 것을 의미한다.

|Node|Relative(Default)|Global|Private|
|---|---|---|---|
|/node1|bar → /bar|/bar → /bar|~bar → /node1/bar|
|/wg/node2|bar → /wg/bar|/bar → /bar|~bar → /wg/node2/bar|
|/wg/node3|foo/bar → /wg/foo/bar|/foo/bar → /foo/bar|~foo/bar → /wg/node3/foo/bar|

<small>[표8-1]네이밍 규칭</small>

## 3. 네이밍 활용

*두 대의 카메라를 어떻게 실행할 수 있을까?*

ROS에 고유 한 이름이 있어야하기 때문에 관련 노드를 두 번 실행하면 이전에 실행 된 노드가 종료된다. 그러나 두 대의 카메라를 실행하기 위해 별도의 프로그램을 실행하거나 소스 코드를 변경하지 않아도된다. 네임 스페이스를 사용하거나 리매핑을 활용하여 노드를 실행할 때 간단히 노드 이름을 변경하면된다.

>이해를 돕기 위해 가상 `camera_package`가 있다고 가정해보자. `camera_package`의 `camera_node`가 실행될 때 카메라 노드가 실행되었다고 가정하면, 이를 실행하는 방법은 다음과 같을 것이다.

```
$rosrun camera_package camera_node
```
`camera_node`가 image 토픽을 통해 카메라의 이미지 데이터를 전송하면 다음과 같이 `rqt_image_view`를 사용하여이 image 토픽을 수신 할 수 있다(가정). 
```
$rosrun rqt_image_view rqt_image_view
```
이제 리매핑하여 이러한 노드의 토픽 값을 수정해보자. 다음 명령은 토픽 이름을 `/front/image`로 변경한다. 아래 명령에서 `image`는 `camera_node`의 토픽 이름이고 아래 예는 실행 명령에서 옵션을 설정하여 토픽 이름을 변경하는 방법을 보여준다.

```
$ rosrun camera_package camera_node image:=front/image
$ rosrun rqt_image_view rqt_image_view image:=front/image
```

예를 들어, front, left 및 right와 같은 세 개의 카메라가있는 경우 여러 노드가 동일한 이름으로 실행될 때 이름이 충돌하여 이전에 실행 된 노드가 종료된다. 따라서, 이름이 같은 노드는 다음과 같은 방식으로 실행할 수 있다. 아래에서 이름 옵션 뒤에 연속 밑줄 (__)이 온다.
`__ns`,`__name`,`__log`,`__ip`,`__hostname` 및 `__master`와 같은 옵션은 노드를 실행할 때 사용되는 특수 옵션이다. 또한, 단일 밑줄 (_)은 프라이빗으로 사용될 경우 토픽 이름 앞에 배치된다.

```
$ rosrun camera_package camera_node __name:=front _device:=/dev/video0
$ rosrun camera_package camera_node __name:=left _device:=/dev/video1
$ rosrun camera_package camera_node __name:=right _device:=/dev/video2
$ rosrun rqt_image_view rqt_image_view
```

하나의 네임스페이스(namespace)로 묶어주고 싶다면 아래와 같이 할 수 있다.

```
$ rosrun camera_package camera_node __ns:=back
$ rosrun rqt_imgae_view rqt_imgae_view __ns:=back
```


## 4. 실제로 구동하기

일단 삼성 USB camera를 USB 포트에 연결 하고, 아래의 명령어를 입력하면 다음과 같이 확인 할 수 있다.

<img src="/assets/img/ros/samsung_web_cam.png"  title="삼성 웹캠 화면"><br>


```
$ ls -ltr /dev/video*
```
<img src="/assets/img/ros/camera_device.png"  title="USB 카메라 장치"><br>


이제부터 활용할 ROS 패키지는 uvc_camera 라는 것이다.

<img src="/assets/img/ros/uvc_camera_wiki.png"  title="uvc_camera package"><br>
출처:[uvc_camera](http://wiki.ros.org/uvc_camera)


cs를 하여 catkin_ws/src로 이동하자.(환경설정에서 다루었던 내용)
```
$ cs
~/catkin_ws/src$ git clone https://github.com/ros-drivers/camera_umd
```
git으로 데이터 패키지를 다운받고 받은 폴더를 ls를 이용하여 확인해보자

```
~/catkin_ws/src$ ls
camera_umd      my_first_ros_pkg  turtlebot3_msgs
CMakeLists.txt  turtlebot3        turtlebot3_simulations
```
이제 패키지를 빌드해보자.
```
~/catkin_ws/src$ cm
```
<img src="/assets/img/ros/ros_uvc_install_fail.png"  title="uvc_camera package 설치실패"><br>

*젠장 에러뜬다.*

의존성 문제로 해당 문제를 해결하기 위해서는 아래의 커멘드를 입력해야 한다.

```
rosdep install --from-paths src --ignore-src --rosdistro=kinetic -y
```

<img src="/assets/img/ros/ros_uvc_install_success.png"  title="uvc_camera package 설치성공"><br>


```
~/catkin_ws$ rospack profile
Full tree crawl took 0.045761 seconds.
Directories marked with (*) contain no manifest.  You may
want to delete these directories.
To get just of list of directories without manifests,
re-run the profile with --zombie-only
-------------------------------------------------------------
0.037673   /opt/ros/kinetic/share
0.005741   /home/memaker/catkin_ws/src
0.002084   /home/memaker/catkin_ws/src/turtlebot3
0.001374   /home/memaker/catkin_ws/src/camera_umd
0.000856   /home/memaker/catkin_ws/src/turtlebot3_simulations
0.000228 * /opt/ros/kinetic/share/OpenCV-3.3.1-dev
0.000049 * /opt/ros/kinetic/share/OpenCV-3.3.1-dev/haarcascades
0.000049 * /opt/ros/kinetic/share/doc
0.000021 * /opt/ros/kinetic/share/OpenCV-3.3.1-dev/lbpcascades
0.000009 * /opt/ros/kinetic/share/doc/liborocos-kdl
```

열심히 해당 폴더로 이동을 한다.

```
~/catkin_ws$ cd ./src/camera_umd/uvc_camera/launch/
~/catkin_ws/src/camera_umd/uvc_camera/launch$ gedit ./camera_node.launch
```

카메라에 따라 해상도 지원하는 스펙이 다를 수 있다. 확인하고 설정하자.

```
<launch>
  <node pkg="uvc_camera" type="uvc_camera_node" name="uvc_camera" output="screen">
    <param name="width" type="int" value="640" />
    <param name="height" type="int" value="480" />
    <param name="fps" type="int" value="30" />
    <param name="frame" type="string" value="wide_stereo" />

    <param name="auto_focus" type="bool" value="False" />
    <param name="focus_absolute" type="int" value="0" />
    <!-- other supported params: auto_exposure, exposure_absolute, brightness, power_line_frequency -->

    <param name="device" type="string" value="/dev/video0" />
    <param name="camera_info_url" type="string" value="file://$(find uvc_camera)/example.yaml" />
  </node>
</launch>
```
편집하고 꼭 저장을 하자.


실행해보자.

```
~/catkin_ws/src/camera_umd/uvc_camera/launch$ cw
~/catkin_ws$ roslaunch uvc_camera camera_node.launch
```
퍼블리셔 노드를 roslaucn로 실행했기 때문에 서브스크라이버로 rqt_image_view를 이용해서 확인해보자.

```
~/catkin_ws$ rqt_image_view
```

<img src="/assets/img/ros/rqt_image_view_uvc_camera.png"  title="uvc_camera 화면"><br>

색감조절이 필요할 듯하지만, 일단 화면이 나오는 것은 확인할 수 있다.








